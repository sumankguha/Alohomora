---
title:  "Generate IVSA dataframe for cohort00"
author: "Suman Guha"
date: "12/04/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(argparser)
```

This notebook compiles all the ICSS files for all the animals of a cohort into a single  

## 1. Setting variables
```{r}
# directory where individual animal data is stored
dataDir <- ""

# landmark dates for experiment/cohort
shaStartDate    <- c("")
lgaStartDate 	<- c("")

# animals in the analysis
subjectList <- c("", "", 
                 "",
                 "",
                 "")

# group information
group_lgaFemale <- c("", "")
group_lgaMale   <- c("")
group_shaFemale <- c("")
group_shaMale   <- c("")

# output files 
outputFileName_experimentDates_longform <- "_ivsaDataframe_longform_cohort00.csv"
outputFileName_experimentDates_wideform <- "_ivsaDataframe_wideform_cohort00.csv"

```

## 2. Generating combined dataframe
## 2.1. Using the preprocessIVSAFiles script to parse MedPC files and generating csv files that has different event types
```{bash, include=FALSE}
# # defining userName to make running the cell in machine agnostic manner
# userName=$(echo $USER)
# 
# # We move to the folder where the cohort data is stored
# cd /Users/$userName/Dropbox\ \(Partners\ HealthCare\)/Projects/R01_2017_OxycSA-NASh-Glutamate/_data_R01_2017/_data_R01_2017_IVSA/Male-Female/ShA+LgA/PM_ICSS/Cohort00/_rigFiles
# 
# # running the preprocessing script over all files in the directory
# for fileName in $(ls \!2019-0* | sort)
# do
#     preprocessIVSAFiles --file $fileName;
# done
```

## 2.2. Using collateIVSAData to collate all the data into a single data frame of the format 
```{bash, include=FALSE}
# # DATA TABLE DESCRIPTION:
# # 
# #   date       |  cohort      | regimen   | group | subjectID | eventType   | eventTime
# #   -----------|--------------|-----------|-------|-----------|-------------|-----------
# #   2018-10-30 |  ICSS+IVSA   | 6H        | MALES | SG7       | rewards     | ...
# #   -----------|--------------|-----------|-------|-----------|-------------|-----------
# #   2018-10-30 |  ICSS+IVSA   | 6H        | MALES | SG7       | corrLever   | ...
# #   -----------|--------------|-----------|-------|-----------|-------------|-----------
# #   2018-10-30 |  ICSS+IVSA   | 6H        | MALES | SG7       | incorrLever | ...
# #   ...
# #   ...
# #   ...
# 
# userName=$(echo $USER)
# 
# # We move to the folder where the cohort files are stored
# # cd </path/to/cohort/data>
# cd /Users/$userName/Dropbox\ \(Partners\ HealthCare\)/Projects/R01_2017_OxycSA-NASh-Glutamate/_data_R01_2017/_data_R01_2017_IVSA/Male-Female/ShA+LgA/PM_ICSS/Cohort00/_csvFiles
# 
# # running the preprocessing script over all files in the directory
# for fileName in $(ls *rewards.csv | sort)
# do
#     collateIVSAData $fileName;
# done
```

```{r, include=FALSE}
fileList <- list.files(path = dataDir, pattern = "collated.csv")
data <- 
  fileList %>%
  purrr::map(~ readr::read_csv(file.path(dataDir, .))) %>%
  purrr::reduce(rbind)
```

## 2.3. Subsetting data to subjects and dates
```{r}
data <- 
  data %>%
  dplyr::filter(Subject %in% subjectList)
```

## 3. Annotating data
## 3.1. Assigning group information
```{r}
data$Experiment[data$Subject %in% group_lgaFemale]  <- c("LgA-Female")
data$Experiment[data$Subject %in% group_lgaMale]    <- c("LgA-Male")
data$Experiment[data$Subject %in% group_shaFemale]  <- c("ShA-Female")
data$Experiment[data$Subject %in% group_shaMale]    <- c("ShA-Male")
```
## 3.2. Assigning drug infusion information
```{r}

```

## 4. Save data
```{r}

```

